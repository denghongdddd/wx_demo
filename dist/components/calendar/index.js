"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var _util=require("./../../api/util.js"),_util2=_interopRequireDefault(_util),isRefresh=!1,selectDate=!1;Component({externalClasses:[],options:{addGlobalClass:!0,multipleSlots:!0},data:{isShow:!1,type:"date-time",rangeType:"radio",disabledData:[],current0:0,list0:[],current1:0,list1:[],nowMonth:"",showTime:"",selectDate:"",value:"",calendarIndex:0,loading:!1,disabled:!1,roundIndex:0},ready:function(){wx.com=this},methods:{init:function(t){var a=this,e=t.date,s=t.type,i=void 0===s?"date-time":s,d=t.disabledData,n=void 0===d?[]:d,r=t.rangeType,h=void 0===r?"radio":r;this.setData({isShow:!0,loading:!0,disabled:!1}),this.data.value="radio"==h?e?new Date(e):new Date:e.map(function(t){return new Date(t)}),this.setData({value:this.data.value,type:"radio"!=h?"date":i,disabledData:n,rangeType:h,roundIndex:0,nowMonth:_util2.default.dateFormat("radio"==h?this.data.value:this.data.value[0]||new Date,"yyyy-MM"),showTime:_util2.default.dateFormat("radio"==h?this.data.value:this.data.value[0]||new Date,"hh:mm"),selectDate:"radio"==h?_util2.default.dateFormat(this.data.value,"yyyy-MM-dd"):this.data.value.map(function(t){return _util2.default.dateFormat(t,"yyyy-MM-dd")}),calendarIndex:0}),this.setData({list0:Object.fromEntries([this.setCalendar(this.data.nowMonth,-1),this.setCalendar(this.data.nowMonth,0),this.setCalendar(this.data.nowMonth,1)]),current0:1}),setTimeout(function(){a.setData({loading:!1})},200)},dateChange:function(t){var a=this;this.setData({loading:!0}),this.setMonth(t.detail.value),setTimeout(function(){a.setData({loading:!1})})},setMonth:function(t){var a=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;selectDate=!0;var s=new Date(t);s.setFullYear(s.getFullYear()+e),this.data.nowMonth!=_util2.default.dateFormat(s,"yyyy-MM")&&(this.data.nowMonth=_util2.default.dateFormat(s,"yyyy-MM"),0==this.data.calendarIndex?(this.setData({list0:[],list1:Object.fromEntries([this.setCalendar(this.data.nowMonth,-1),this.setCalendar(this.data.nowMonth,0),this.setCalendar(this.data.nowMonth,1)])}),this.setData({current0:0,current1:1})):(this.setData({list0:Object.fromEntries([this.setCalendar(this.data.nowMonth,-1),this.setCalendar(this.data.nowMonth,0),this.setCalendar(this.data.nowMonth,1)]),list1:[]}),this.setData({current0:1,current1:0})),setTimeout(function(){a.setData({calendarIndex:a.data.calendarIndex?0:1,nowMonth:a.data.nowMonth})}))},timeChange:function(t){this.setData({showTime:t.detail.value})},submit:function(){this.hideDate(),"date-time"==this.data.type&&(this.data.value.setHours(this.data.showTime.slice(0,2)),this.data.value.setMinutes(this.data.showTime.slice(3,5))),this.triggerEvent("submit",this.data.value)},hideDate:function(){this.setData({disabled:!0,list0:[],list1:[]}),this.setData({current0:0,current1:0}),this.setData({isShow:!1}),this.triggerEvent("cancel")},select_round:function(t){this.setData({roundIndex:t.currentTarget.dataset.index})},selectDay:function(t){var a=this.data["list"+this.data.calendarIndex][t.currentTarget.dataset.index[0]][t.currentTarget.dataset.index[1]][t.currentTarget.dataset.index[2]];if(!a.isDisabled)if("radio"==this.data.rangeType)this.setData({selectDate:a.dateForm,value:a.Date});else if("checkbox"==this.data.rangeType){var e=this.data.selectDate.indexOf(a.dateForm);e>=0?this.data.value.splice(e,1):this.data.value.push(a.Date),this.setData({value:this.data.value,selectDate:this.data.value.map(function(t){return _util2.default.dateFormat(t,"yyyy-MM-dd")})})}else"round"==this.data.rangeType&&(!this.data.selectDate[1]||0==this.data.roundIndex&&a.dateForm<this.data.selectDate[1]||1==this.data.roundIndex&&a.dateForm>this.data.selectDate[0])&&(this.data.value[this.data.roundIndex]=a.Date,this.data.selectDate[this.data.roundIndex]=a.dateForm,this.setData({value:this.data.value,selectDate:this.data.selectDate}))},change:function(t){selectDate||(this.setData({disabled:!0}),this["current"+this.data.calendarIndex]=t.detail.current,this.data.calendarIndex==t.currentTarget.dataset.index&&(this.data.nowMonth=Object.keys(this.data["list"+this.data.calendarIndex])[t.detail.current],Object.keys(this.data["list"+(this.data.calendarIndex?0:1)]).length<3||this.data.nowMonth!=Object.keys(this.data["list"+(this.data.calendarIndex?0:1)])[1]?(0==this.data.calendarIndex?(this.setData({list1:Object.fromEntries([this.setCalendar(this.data.nowMonth,-1),this.setCalendar(this.data.nowMonth,0),this.setCalendar(this.data.nowMonth,1)])}),this.setData({current1:1})):(this.setData({list0:Object.fromEntries([this.setCalendar(this.data.nowMonth,-1),this.setCalendar(this.data.nowMonth,0),this.setCalendar(this.data.nowMonth,1)])}),this.setData({current0:1})),isRefresh=!1):(0==this.data.calendarIndex?this.setData({current1:1}):this.setData({current0:1}),isRefresh=!0)))},end:function(t){selectDate?selectDate=!1:(t.currentTarget.dataset.index!=this.data.calendarIndex||isRefresh)&&(isRefresh=!1,this.setData({calendarIndex:this.data.calendarIndex?0:1,nowMonth:this.data.nowMonth,disabled:!1}))},setCalendar:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=new Date(t),s=[];e.setDate(1),e.setMonth(e.getMonth()+a);var i=_util2.default.dateFormat(e,"yyyy-MM");if(this.data.list0[i])return[i,this.data.list0[i]];if(this.data.list1[i])return[i,this.data.list1[i]];var d=e.getDay();e.setDate(1-d);for(var n=0;n<6;n++){for(var r=s[n]||[],h=0;h<7;h++)r.push({isNow:_util2.default.dateFormat(e,"yyyy-MM-dd")==_util2.default.dateFormat(new Date,"yyyy-MM-dd"),dateForm:_util2.default.dateFormat(e,"yyyy-MM-dd"),Date:new Date(e),isDisabled:this.isDisabled(e)}),e.setDate(e.getDate()+1);s[n]=r,r=null}return[i,s]},isDisabled:function(t){for(var a=0;a<this.data.disabledData.length;a++){if("Array"==this.data.disabledData[a].nv_constructor&&new Date(this.data.disabledData[a][0])<=new Date(t)&&new Date(t)<=new Date(this.data.disabledData[a][1]))return!0;if(_util2.default.dateFormat(new Date(this.data.disabledData[a]),"yyyy-MM-dd")==_util2.default.dateFormat(new Date(t),"yyyy-MM-dd"))return!0}return!1}}});