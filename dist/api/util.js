"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _asyncToGenerator(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,r){function n(a,o){try{var i=e[a](o),u=i.value}catch(t){return void r(t)}if(!i.done)return Promise.resolve(u).then(function(t){n("next",t)},function(t){n("throw",t)});t(u)}return n("next")})}}Object.defineProperty(exports,"__esModule",{value:!0});var _tips=require("./../utils/tips.js"),_tips2=_interopRequireDefault(_tips),_request=require("./../utils/request.js"),_request2=_interopRequireDefault(_request),util={},request=require("./../utils/request.js"),CryptoJS=require("./../npm/crypto-js/index.js"),Url="https://weixin.huansi.net/apiproxy/huansi/service";util.getTimestamp=function(t){return t?Date.parse(new Date(t)):Date.parse(new Date)},util.getType=function(t){var e=Object.prototype.toString;return{"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regExp","[object Undefined]":"undefined","[object Null]":"null","[object Object]":"object"}[e.call(t)]},util.deepClone=function(t){var e,r=util.getType(t);if("array"===r)e=[];else{if("object"!==r)return t;e={}}if("array"===r)for(var n=0,a=t.length;n<a;n++)e.push(util.deepClone(t[n]));else if("object"===r)for(var o in t)e[o]=util.deepClone(t[o]);return e},util.dateFormat=function(t,e){var r=new Date(t),n={"M+":r.getMonth()+1,"d+":r.getDate(),"h+":r.getHours(),"m+":r.getMinutes(),"s+":r.getSeconds(),"q+":Math.floor((r.getMonth()+3)/3),S:r.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(r.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in n)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n[a]:("00"+n[a]).substr((""+n[a]).length)));return e},util.cutDate=function(t,e,r){var n=t.getTime(),a=1e3*e*60*60*24,o=n-a;return util.dateFormat(new Date(o),"yyyy-MM-dd")},util.currentDate=function(){var t=new Date,e=parseInt(t.getFullYear()),r=parseInt(t.getMonth())+1,n=parseInt(t.getDate());return r<10&&(r=0+r.toString()),n<10&&(n=0+n.toString()),e.toString()+r+n},util.getDate=function(t){var e=new Date;switch(t){case"本日":return util.dateFormat(new Date,"yyyy-MM-dd");case"本周":var r=e.getDay()||7;return util.dateFormat(new Date(e.getFullYear(),e.getMonth(),e.getDate()+1-r),"yyyy-MM-dd");case"本月":return util.dateFormat(new Date,"yyyy-MM")+"-01";case"本年":return e.getFullYear()+"-01-01"}},util.Trim=function(t){return String(t).replace(/(^\s*)|(\s*$)/g,"")},util.toDecimal=function(t){var e=parseFloat(t);if(!isNaN(e))return e=Math.round(100*t)/100},util.toPercent=function(t){var e=Number(100*t).toFixed(2);return e+="%"};var map={0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,"+":62,"/":63};util.base64to2=function(t){var e=.75*t.length;t=t.replace(/=*$/,"");for(var r=new Int8Array(e),n=void 0,a=void 0,o=void 0,i=void 0,u=0,s=0;s<t.length;s+=4)n=map[t[s]],a=map[t[s+1]],o=map[t[s+2]],i=map[t[s+3]],r[u++]=n<<2|a>>4,r[u++]=a<<4|o>>2,r[u++]=o<<6|i;return r},util.toBase64=function(t){var e,r,n,a,o,i,u,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",l=0;for(t=util._utf8_encode(t);l<t.length;)e=t.charCodeAt(l++),r=t.charCodeAt(l++),n=t.charCodeAt(l++),a=e>>2,o=(3&e)<<4|r>>4,i=(15&r)<<2|n>>6,u=63&n,isNaN(r)?i=u=64:isNaN(n)&&(u=64),c=c+s.charAt(a)+s.charAt(o)+s.charAt(i)+s.charAt(u);return c},util._utf8_encode=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",r=0;r<t.length;r++){var n=t.charCodeAt(r);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e},util.DesEncrypt=function(t,e){if(null==e||e.length<=0)return alert("Please enter a password with which to encrypt the message."),null;for(var r="",n=0;n<e.length;n++)r+=e.charCodeAt(n).toString();var a=Math.floor(r.length/5),o=parseInt(r.charAt(a)+r.charAt(2*a)+r.charAt(3*a)+r.charAt(4*a)+r.charAt(5*a)),i=Math.ceil(e.length/2),u=Math.pow(2,31)-1;if(o<2)return alert("Algorithm cannot find a suitable hash. Please choose a different password.  Possible considerations are to choose a more complex or longer password."),null;var s=Math.round(1e9*Math.random())%1e8;for(r+=s;r.length>10;)r=(parseInt(r.substring(0,10))+parseInt(r.substring(10,r.length))).toString();r=(o*r+i)%u;for(var c="",l="",n=0;n<t.length;n++)c=parseInt(t.charCodeAt(n)^Math.floor(r/u*255)),l+=c<16?"0"+c.toString(16):c.toString(16),r=(o*r+i)%u;for(s=s.toString(16);s.length<8;)s="0"+s;return l+=s},util.sha1_to_base64=function(t){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",n=0,a=0,o=0,i=0;i<t.length;++i)o=t[i]>="A"&&t[i]<="Z"?t.charCodeAt(i)-55:t[i]>="a"&&t[i]<="z"?t.charCodeAt(i)-87:t.charCodeAt(i)-48,n=n<<4|o,(a+=4)>=6&&(a-=6,r+=e[n>>>a],n&=~(-1<<a));a>0&&(n<<=6-a,r+=e[n]);var u=r.length%4;if(u>0)for(var i=0;i<4-u;++i)r+="=";return r},util.authSetting=function(t){return new Promise(function(e){wx.getSetting({success:function(r){r.authSetting[t]?e(!0):wx.authorize({scope:t,success:function(t){e(!0)},fail:function(r){console.log(r),wx.showModal({content:"检测到您没授权,是否去设置打开？",confirmText:"确认",cancelText:"取消",success:function(r){r.confirm?(console.log("用户点击确认"),wx.openSetting({success:function(r){e(r.authSetting[t])},fail:function(){e(!1)}})):(console.log("用户点击取消"),e(!1))},fail:function(){e(!1)}})}})},fail:function(){e(!1)}})})},util.drawCanvas=function(t,e){return new Promise(function(r,n){var a=wx.createCanvasContext("myCanvas");wx.createSelectorQuery().select(".img_size").boundingClientRect(function(n){a.drawImage(e,0,0,n.width,n.height),a.draw(),wx.canvasToTempFilePath({canvasId:t,width:n.width,height:n.height,destWidth:100,destHeight:100,quality:10,success:function(t){r(t)},complete:function(t){console.log(t)}})}).exec()})},util.isMobile=function(t){return/^(13[0-9]|15[0-9]|16[0-9]|17[0-9]|1[89][0-9]|14[57])[0-9]{8}$/.test(this.Trim(t))||/^(0\d{2,3}-\d{7,8})/.test(t)},util.formatValidationData=function(t,e){e.map(function(e){e.field==t&&wx.showModal({title:"提示",content:e.modal,showCancel:!1,success:function(t){}})})},util.validation=function(t,e){for(var r in t){var n=util.getType(t[r]);if("string"==n&&!t[r])return util.formatValidationData(r,e),!1;if("array"==n&&0==t[r].length)return this.formatValidationData(r,e),!1;if("object"==n&&"{}"==JSON.stringify(t[r]))return this.formatValidationData(r,e),!1}return!0},util.saveOperationLog=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=Url+"/hsappmanual/log/",t.next=3,_request2.default.https(r,"post",e,{});case 3:if(!(n=t.sent)||!n.hasOwnProperty("error_data")){t.next=7;break}return this.$parent.Tip.alert("保存日志失败！",700),t.abrupt("return",!1);case 7:return t.abrupt("return",new Promise(function(t,e){t(n)}));case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),exports.default=util;